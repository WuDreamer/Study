(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/search/search"],{"02a7":function(e,t,a){},"1a08":function(e,t,a){"use strict";(function(e,n){var i=a("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(a("9523"));var c={data:function(){return{mallGoodsDbName:"opendb-news-articles",searchLogDbName:"opendb-search-log",statusBarHeight:"0px",localSearchList:e.getStorageSync("__local_search_history"),localSearchListDel:!1,netHotListIsHide:!1,searchText:"",iconColor:"#999999",associativeList:[],keyBoardPopup:!1,hotWorld:"请输入搜索内容",focus:!0}},created:function(){var t=this;this.db=n.database(),this.searchLogDb=this.db.collection(this.searchLogDbName),this.mallGoodsDb=this.db.collection(this.mallGoodsDbName),e.onKeyboardHeightChange((function(e){t.keyBoardPopup=0!==e.height})),this.searchText=getApp().globalData.searchText},computed:{associativeShow:function(){return this.searchText&&this.associativeList.length}},onLoad:function(){},methods:{clear:function(e){console.log("res: ",e)},confirm:function(e){this.search(e.value)},cancel:function(t){e.hideKeyboard(),this.searchText="",this.loadList()},search:function(t){(t||this.hotWorld)&&(t?(this.searchText!==t&&(this.searchText=t),this.localSearchListManage(t),this.searchLogDbAdd(t)):this.hotWorld&&(this.searchText=this.hotWorld),e.hideKeyboard(),this.loadList(this.searchText))},localSearchListManage:function(t){var a=e.getStorageSync("__local_search_history");a.length?(this.localSearchList.unshift(t),function(e){for(var t=e.length-1;t>=0;t--){var a=e.indexOf(e[t]),n=e.lastIndexOf(e[t]);a!=n&&e.splice(n,1)}}(this.localSearchList),this.localSearchList.length>10&&this.localSearchList.pop()):this.localSearchList=[t],e.setStorageSync("__local_search_history",this.localSearchList)},LocalSearchListClear:function(){var t=this;e.showModal({content:"确认清空搜索历史吗",confirmText:"删除",confirmColor:"red",cancelColor:"#808080",success:function(a){a.confirm&&(t.localSearchListDel=!1,t.localSearchList=[],e.removeStorageSync("__local_search_history"))}})},LocalSearchlistItemClick:function(t,a){if(this.localSearchListDel)return this.localSearchList.splice(a,1),e.setStorageSync("__local_search_history",this.localSearchList),void(this.localSearchList.length||(this.localSearchListDel=!1));this.search(t)},searchHotRefresh:function(){this.$refs.udb.refresh()},searchLogDbAdd:function(e){var t=this;this.getDeviceId().then((function(a){t.searchLogDb.add({device_id:a,content:e,create_date:Date.now()})}))},getDeviceId:function(){return new Promise((function(t,a){var n=e.getStorageSync("uni_id");t(n||e.getSystemInfoSync().system+"_"+Math.random().toString(36).substr(2))}))},associativeClick:function(t){console.log("associativeClick: ",t),e.navigateTo({url:"/pages/list/detail?_id="+t._id})},loadList:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";getApp().globalData.searchText=t,e.navigateTo({url:"/pages/list/search/result"})},backPage:function(){e.navigateBack()}},watch:{searchText:function(e,t,a){var n=e,i=null,o=!0;return a&&n(),function(){var e=arguments,a=this;o&&(o=!1,n.apply(a,e)),i&&clearTimeout(i),i=setTimeout((function(){clearTimeout(i),i=null,n.apply(a,e)}),t||200)}}((function(e){var t=this;e?this.mallGoodsDb.where((0,o.default)({},"desc",new RegExp(e,"gi"))).field("_id,desc").get().then((function(e){t.associativeList=e.result.data})):(this.associativeList.length=0,getApp().globalData.searchText="")}),100)}};t.default=c}).call(this,a("543d")["default"],a("a9ff")["default"])},"2a5c":function(e,t,a){"use strict";var n=a("02a7"),i=a.n(n);i.a},"3e57":function(e,t,a){"use strict";var n=a("c8ea"),i=a.n(n);i.a},7210:function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"c",(function(){return o})),a.d(t,"a",(function(){return n}));var n={uniSearchBar:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uni-search-bar/components/uni-search-bar/uni-search-bar")]).then(a.bind(null,"05bc"))},uniIcons:function(){return Promise.all([a.e("common/vendor"),a.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(a.bind(null,"effa"))},unicloudDb:function(){return Promise.all([a.e("common/vendor"),a.e("node-modules/@dcloudio/uni-cli-shared/components/unicloud-db")]).then(a.bind(null,"960d"))}},i=function(){var e=this,t=e.$createElement,a=(e._self._c,e.localSearchList.length),n=e.$hasSSP("50cad900-6"),i=n?e.$getSSP("50cad900-6","default")["loading"]&&!e.netHotListIsHide:null,o=!n||i||e.netHotListIsHide?null:e.$getSSP("50cad900-6","default"),c=n&&!i&&!e.netHotListIsHide&&o["error"]?e.$getSSP("50cad900-6","default"):null,s=!n||i||e.netHotListIsHide||o["error"]?null:e.$getSSP("50cad900-6","default");e._isMounted||(e.e0=function(t){e.localSearchListDel=!0},e.e1=function(t){e.localSearchListDel=!1},e.e2=function(t){e.netHotListIsHide=!e.netHotListIsHide},e.e3=function(t,a){var n=arguments[arguments.length-1].currentTarget.dataset,i=n.eventParams||n["event-params"];a=i.word;return e.search(a.content)}),e.$mp.data=Object.assign({},{$root:{g0:a,m0:n,m1:i,m2:o,m3:c,m4:s}})},o=[]},"78ef":function(e,t,a){"use strict";a.r(t);var n=a("1a08"),i=a.n(n);for(var o in n)["default"].indexOf(o)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(o);t["default"]=i.a},"7e17":function(e,t,a){"use strict";a.r(t);var n=a("7210"),i=a("78ef");for(var o in i)["default"].indexOf(o)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(o);a("2a5c"),a("3e57");var c=a("f0c5"),s=Object(c["a"])(i["default"],n["b"],n["c"],!1,null,"f44e3942",null,!1,n["a"],void 0);t["default"]=s.exports},c8ea:function(e,t,a){},f216:function(e,t,a){"use strict";(function(e,t){var n=a("4ea4");a("ff12"),a("a9ff");n(a("66fd"));var i=n(a("7e17"));e.__webpack_require_UNI_MP_PLUGIN__=a,t(i.default)}).call(this,a("bc2e")["default"],a("543d")["createPage"])}},[["f216","common/runtime","common/vendor"]]]);